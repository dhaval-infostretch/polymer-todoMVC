
<polymer-element name="todo-list" attributes="todos checked">
  <template>
      <template repeat="{{todo,todoIndex in todos}}">    
    <li>
<div class="view">
      <input class="toggle" type="checkbox" value="done" data-index="{{todoIndex}}" on-change="{{completeTodo}}" />
      <label on-dblclick="{{editTodo}}" data-index="{{todoIndex}}" style="text-decoration:none">{{todo.todoText}}</label>
      <input type="text" data-index="{{todoIndex}}" on-keypress="{{todoEditedDone}}" value="{{todo.todoText}}" style="display:none" />
      <button class="destroy" on-click="{{cancelTodo}}">X</button>
</div>
    </li>
      </template>
  </template>
    <script>
        Polymer('todo-list',{
            publish:{
                    todos:[],
                },
            cancelTodo:function(event,detail,sender){
                var template = document.querySelector('template[is=auto-binding]');
                template.todos.splice(this.todoIndex,1);
                template.incompleteTodo=0;
                for(var i=0;i<template.todos.length;i++){
            if(!template.todos[i].status){
                template.incompleteTodo+=1;
            }
        }
            },
            completeTodo:function(event,detail,sender){
                var template = document.querySelector('template[is=auto-binding]');
                if(sender.checked || this.checked){
                    sender.parentNode.getElementsByTagName('label')[0].style.textDecoration ='line-through';
                    this.todos[sender.attributes['data-index'].value].status=true;
                    template.incompleteTodo=template.incompleteTodo - 1;
                }
                else
                {
                    sender.parentNode.getElementsByTagName('label')[0].style.textDecoration ='none';
                    this.todos[sender.attributes['data-index'].value].status=false;
                    template.incompleteTodo=template.incompleteTodo + 1;
                }
            },
            editTodo:function(event,detail,sender){
                console.log(sender.attributes['data-index'].value);
                sender.style.display='none';
                sender.parentNode.querySelector('input[type=text]').style.display='block';
                
            },
            todoEditedDone:function(event,detail,sender){
                if(event.keyCode === 13){
                    this.todos[sender.attributes['data-index'].value].todoText=sender.value;
                    sender.style.display='none';
                    sender.parentNode.querySelector('label').style.display='block';
                }
            },
            checkedChanged:function(oldvalue,newvalue){
                var evt = document.createEvent("HTMLEvents");
                evt.initEvent("change", false, true);
                if(this.shadowRoot.querySelectorAll('input[type=checkbox]')){
                for(var i=0;i<this.shadowRoot.querySelectorAll('input[type=checkbox]').length;i++){
                    if(this.checked){
                        this.shadowRoot.querySelectorAll('input[type=checkbox]')[i].checked=true;
                        this.shadowRoot.querySelectorAll('input[type=checkbox]')[i].dispatchEvent(evt);
                    }
                    else{
                        this.shadowRoot.querySelectorAll('input[type=checkbox]')[i].checked=false;
                        this.shadowRoot.querySelectorAll('input[type=checkbox]')[i].dispatchEvent(evt);
                    }
                }
            }
        }
        });
    </script>
</polymer-element>
